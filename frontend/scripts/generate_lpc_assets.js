const fs = require('fs');
const path = require('path');

// ---------------------------------------------------------
// 32x32 HIGH-FIDELITY GRIDS
// "Paper Doll" Layers
// ---------------------------------------------------------

// --- BODY (Base Skin) ---
// A simple standing pose.
const BODY_HUMAN = [
    "................................",
    "................................",
    "...........HHHHHH...............",
    "..........HHHHHHHH..............",
    "..........HHHHHHHH..............",
    "..........HHHHHHHH..............",
    "...........HHHHHH...............", // Head
    "............NNNN................", // Neck
    "..........SSSSSSSS..............", // Shoulders
    ".........SSSSSSSSSS.............",
    ".........SSSSSSSSSS.............",
    ".........SSSSSSSSSS.............",
    ".........SSSSSSSSSS.............", // Torso
    ".........AAAAAAAAAA.............", // Hips
    ".........LL......LL.............",
    ".........LL......LL.............",
    ".........LL......LL.............",
    ".........LL......LL.............",
    ".........LL......LL.............",
    ".........LL......LL.............",
    ".........LL......LL.............", // Legs
    ".........FF......FF.............", // Feet
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................"
];

// --- PANTS ---
const PANTS_JEANS = [
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    ".........PPPPPPPPPP.............", // Waist
    ".........PP......PP.............",
    ".........PP......PP.............",
    ".........PP......PP.............",
    ".........PP......PP.............",
    ".........PP......PP.............",
    ".........PP......PP.............",
    ".........PP......PP.............", // Legs
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................"
];

// --- SHIRT ---
const SHIRT_TSHIRT = [
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "..........SSSSSSSS..............",
    ".........SSSSSSSSSS.............",
    ".........SSSSSSSSSS.............",
    ".........SSSSSSSSSS.............",
    ".........SSSSSSSSSS.............",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................"
];

// --- HAIR ---
const HAIR_SPIKY = [
    "................................",
    "..........X..XX..X..............",
    ".........XXXXXXXXXX.............",
    ".........XXXXXXXXXX.............",
    "..........XXXXXXXX..............",
    "...........XXXXXX...............",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................"
];

// --- WEAPON ---
const WEAPON_SWORD = [
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "...................S............", // Tip
    "..................SS............",
    ".................SS.............",
    "................SS..............",
    "...............SS...............",
    "..............SS................",
    ".............SS.................", // Blade
    "............HH..................", // Hilt
    "...........HH...................",
    "..........H.....................", // Handle
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................",
    "................................"
];


// ---------------------------------------------------------
// GENERATOR UTILS
// ---------------------------------------------------------

function pixelToSvgRect(x, y, color) {
    const size = 2; // 32x32 grid * 2 = 64x64 frame
    return `<rect x="${x * size}" y="${y * size}" width="${size}" height="${size}" fill="${color}" />`;
}

function generateLayerSVG(grid, color) {
    let svgContent = "";
    for (let y = 0; y < 32; y++) {
        for (let x = 0; x < 32; x++) {
            const char = grid[y][x];
            if (char !== '.') {
                svgContent += pixelToSvgRect(x, y, color);
            }
        }
    }
    return `<svg width="64" height="64" xmlns="http://www.w3.org/2000/svg">${svgContent}</svg>`;
}

function saveSVG(name, content) {
    const dir = path.join(__dirname, '../public/layers');
    // Ensure dir exists
    if (!fs.existsSync(dir)) {
        fs.mkdirSync(dir);
    }

    const filePath = path.join(dir, name + '.svg');
    fs.writeFileSync(filePath, content);
    console.log(`Saved ${name}.svg`);
}

// ---------------------------------------------------------
// EXECUTION
// We export everything as WHITE (#FFFFFF) so they can be tinted in the Canvas.
// ---------------------------------------------------------

saveSVG('base_human', generateLayerSVG(BODY_HUMAN, '#FFFFFF'));
saveSVG('pants_base', generateLayerSVG(PANTS_JEANS, '#FFFFFF'));
saveSVG('shirt_base', generateLayerSVG(SHIRT_TSHIRT, '#FFFFFF'));
saveSVG('hair_base', generateLayerSVG(HAIR_SPIKY, '#FFFFFF'));
saveSVG('weapon_sword', generateLayerSVG(WEAPON_SWORD, '#FFFFFF'));
